<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Teacher Attendance â€“ Polygon School</title>
<style>
  body { font-family: Arial,sans-serif; background: #f7fbff; margin:0; min-height:100vh; }
  .container { background: #fff; max-width: 650px; margin:32px auto; border-radius:16px; box-shadow:0 1px 16px #0003; padding:30px; }
  .logo-wrap { display:flex; justify-content:center; align-items:center; margin-bottom:20px; }
  .logo-circle { background:#fff; border-radius:50%; box-shadow:0 2px 8px #00339644; width:140px; height:140px; display:flex; align-items:center; justify-content:center; padding:10px; }
  .logo-circle img { width:120px; height:120px; border-radius:50%; }
  h2,h3 { color: #114c98; text-align: center; margin-top:0; }
  label, select, input { display:block; margin:6px 0; font-size:1rem; }
  .hidden { display: none !important; }
  button { margin:6px 9px 6px 0; padding:5px 15px; background:#114c98; color:#fff; font-weight:600; border:0; border-radius:5px; cursor:pointer;}
  button:disabled { background:#9bbcec; color:#f9f9f9; cursor:not-allowed;}
  button:hover:enabled { background:#156ddf;}
  table { width:100%; border-collapse:collapse; margin-top:12px;}
  th,td { border:1px solid #dde8f7; padding:7px; text-align:left;}
  th { background:#e7f2fb; color:#184a80;}
  #login, #attendance { display:none; }
  input[type="text"],input[type="password"],input[type="number"] { width:95%;padding:6px; border:1px solid #cee5fc; border-radius:6px;}
</style>
</head>
<body>
<div class="container">
  <div class="logo-wrap">
    <div class="logo-circle"><img src="ChatGPT-Image-Oct-30-2025-12_48_35-PM.jpg" alt="Polygon Logo" /></div>
  </div>
  <h2>Polygon Senior Secondary School</h2>

  <div id="login">
    <h3>Teacher Login</h3>
    <label>ID: <input id="teacherId" type="text" /></label>
    <label>Password: <input id="teacherPass" type="password" /></label>
    <button onclick="login()">Login</button>
    <p id="loginMessage" style="color:red;"></p>
  </div>

  <div id="attendance">
    <h3>Attendance Panel</h3>
    <label>Class:
      <select id="classSelect" onchange="handleClassChange()">
        <option value="">Select Class</option>
        <option value="ANKUR">ANKUR</option>
        <option value="MUKUL">MUKUL</option>
        <option value="1">Class 1</option>
        <option value="2">Class 2</option>
        <option value="3">Class 3</option>
        <option value="4">Class 4</option>
        <option value="5">Class 5</option>
        <option value="6">Class 6</option>
        <option value="7">Class 7</option>
        <option value="8">Class 8</option>
        <option value="9">Class 9</option>
        <option value="10">Class 10</option>
        <option value="11">Class 11</option>
        <option value="12">Class 12</option>
      </select>
    </label>
    
    <div id="streamSectionDiv" class="hidden">
      <label>Stream:
        <select id="streamSelect" onchange="handleStreamChange()">
          <option value="">Select Stream</option>
          <option value="Arts">Arts</option>
          <option value="Science">Science</option>
        </select>
      </label>
      <label>Section:
        <select id="sectionSelect" onchange="loadStudents()">
          <option value="">Select Section</option>
          <option value="A">A</option>
          <option value="B">B</option>
        </select>
      </label>
    </div>

    <button onclick="loadStudents()">Reload Students</button>

    <h4 style="margin-bottom:4px;color:#156ddf;">Add Student</h4>
    <label>Name: <input id="studentName" type="text" /></label>
    <label>Roll No: <input id="rollNo" type="number" /></label>
    <label>Parent Number: <input id="parentNo" type="text" /></label>
    <button onclick="addStudent()" id="addStudentBtn">Add Student</button>

    <h4 style="margin-top:22px;color:#156ddf;">Student List</h4>
    <table id="studentTable">
      <thead>
        <tr><th>Roll No</th><th>Name</th><th>Parent No</th><th>Status</th><th>Remove</th></tr>
      </thead>
      <tbody></tbody>
    </table>
    <button onclick="submitAttendance()">Submit Attendance</button>
    <button onclick="shareAttendanceGroup()">Share to WhatsApp</button>
    <p id="attMsg" style="color:green;"></p>
  </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script>
const firebaseConfig = {
  apiKey: "AIzaSyD3C_5CptcWNUJ35E4MzG-fKy7fTjQDCX8",
  authDomain: "polygon-fe569.firebaseapp.com",
  projectId: "polygon-fe569",
  storageBucket: "polygon-fe569.firebasestorage.app",
  messagingSenderId: "75984706919",
  appId: "1:75984706919:web:636bac2ea60839d87423c2"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
let lastAttendanceList = [];

function login() {
  if (document.getElementById("teacherId").value === "30102025" && document.getElementById("teacherPass").value === "polygon") {
    document.getElementById("login").style.display = "none";
    document.getElementById("attendance").style.display = "block";
  } else { document.getElementById("loginMessage").innerText = "Invalid Login"; }
}

function handleClassChange() {
  const cls = document.getElementById("classSelect").value;
  const ssDiv = document.getElementById("streamSectionDiv");
  if (cls === "11" || cls === "12") {
    ssDiv.classList.remove("hidden");
  } else {
    ssDiv.classList.add("hidden");
    if(cls) loadStudents();
  }
  clearStudentsTable();
}

function handleStreamChange() {
  document.getElementById("sectionSelect").value = "";
  clearStudentsTable();
}

function getKey() {
  const cls = document.getElementById("classSelect").value;
  if (!cls) return null;
  if (cls === "11" || cls === "12") {
    const stream = document.getElementById("streamSelect").value;
    const section = document.getElementById("sectionSelect").value;
    return (stream && section) ? `${cls}-${stream}-${section}` : null;
  }
  return cls;
}

async function loadStudents() {
  const key = getKey();
  if (!key) return;
  const doc = await db.collection("polygonStudents").doc(key).get();
  window.studentsData = doc.exists ? (doc.data().students || []) : [];
  updateStudentsTable(window.studentsData);
}

function updateStudentsTable(students) {
  let tbody = document.querySelector("#studentTable tbody");
  tbody.innerHTML = "";
  students.forEach((s, i) => {
    let tr = document.createElement("tr");
    tr.innerHTML = `<td>${s.roll}</td><td>${s.name}</td><td>${s.parentNo}</td>
      <td><button onclick="markStatus('${s.roll}','Present')">P</button>
      <button style="background:red" onclick="markStatus('${s.roll}','Absent')">A</button>
      <span id="status-${s.roll}">${s.status || ""}</span></td>
      <td><button onclick="removeStudent(${i})">X</button></td>`;
    tbody.appendChild(tr);
  });
}

async function markStatus(roll, status) {
  const key = getKey();
  let student = window.studentsData.find(s => s.roll === roll);
  if (student) {
    student.status = status;
    status === "Present" ? (student.present = (student.present || 0) + 1) : (student.absent = (student.absent || 0) + 1);
    await db.collection("polygonStudents").doc(key).set({ students: window.studentsData });
    updateStudentsTable(window.studentsData);
  }
}

async function addStudent() {
  const key = getKey();
  const name = document.getElementById("studentName").value;
  const roll = document.getElementById("rollNo").value;
  const parentNo = document.getElementById("parentNo").value;
  if (!key || !name || !roll) return alert("Fill all details");
  window.studentsData.push({ name, roll, parentNo, status: "", present: 0, absent: 0 });
  await db.collection("polygonStudents").doc(key).set({ students: window.studentsData });
  updateStudentsTable(window.studentsData);
}

async function removeStudent(index) {
  window.studentsData.splice(index, 1);
  await db.collection("polygonStudents").doc(getKey()).set({ students: window.studentsData });
  updateStudentsTable(window.studentsData);
}

async function submitAttendance() {
  const key = getKey();
  lastAttendanceList = JSON.parse(JSON.stringify(window.studentsData));
  window.studentsData.forEach(s => s.status = "");
  await db.collection("polygonStudents").doc(key).set({ students: window.studentsData });
  updateStudentsTable(window.studentsData);
  document.getElementById("attMsg").innerText = "Submitted!";
}

function shareAttendanceGroup() {
  const key = getKey();
  let msg = `Attendance: ${key}\n\nPresent:\n`;
  lastAttendanceList.filter(s => s.status === "Present").forEach(s => msg += `- ${s.name}\n`);
  msg += `\nAbsent:\n`;
  lastAttendanceList.filter(s => s.status === "Absent").forEach(s => msg += `- ${s.name}\n`);
  window.open(`https://wa.me/?text=${encodeURIComponent(msg)}`, "_blank");
}

window.onload = () => { document.getElementById("login").style.display = "block"; };
</script>
</body>
</html>
